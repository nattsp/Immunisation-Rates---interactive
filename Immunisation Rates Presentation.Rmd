---
title: "Immunisation Rates Presentation"
author: "Natalie Phillips"
date: "19 August 2017"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.path = 'figure/')
library(xlsx)
library(dplyr)
library(tidyr)
library(zoo)
library(xts)
library(dygraphs)
library(ggplot2)
```

## Immunisation Rates in Australia

There are new laws in Australia limiting financial assistance to families where children are not immunised. It is important we understand the rate of immunisation in this country. The statistics in this presentation were gathered from the [Immunise Australia Program](http://www.immunise.health.gov.au/) webpage from the Australian Government - Department of Health.

Create the data folders.


```{r creatDataFolder, message=FALSE, warning=FALSE}
#Create a data directory if one doesn't already exist
if (!file.exists("data")){
    dir.create("data")
}
if (!file.exists("data\\base")){
    dir.create("data\\base")
}
if (!file.exists("data\\processed")){
    dir.create("data\\processed")
}
```

### Obtaining and loading the data

I chose the excel from of the data to down load and stored the details in a file called dataDetails.xlsx. Download the data from the website use a manually collected 


```{r download, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
dataDetails <- read.xlsx2(
    file = ".\\data\\dataDetails.xlsx"
    ,sheetName = "Sheet1"
    ,colClasses = c(
        "character"
        ,"character"
        ,"character"
        ,"numeric"
        ,"numeric"
        ,"numeric"
        ,"character"
    )
)

readFile <- function(x){
    if(!file.exists(x[2])){
        download.file(
            x[1]
            ,destfile = x[2]
            ,mode = "wb"
        )
    }
}
invisible(apply(dataDetails, 1, readFile))

```

Load the eight spreadsheets into a single dataframe noting the unique "date of processing" of each file.

```{r defineFun, echo=FALSE}
immClasses <- c(
    "character"
    ,"character"
    ,"character"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
    ,"numeric"
)

colClean <- function(x){
    colnames(x) <- gsub("\\.+", "_", colnames(x));
    colnames(x) <- gsub("X_", "PCT_", colnames(x));
    colnames(x) <- gsub("_$", "", colnames(x));
    x 
}

ageFactors <- function(x){
    x <- factor(
        x
        ,levels = c(
            "12-<15 Months"
            ,"24-<27 Months"
            ,"60-<63 Months"
        )
        ,ordered=TRUE
    );
    x
}

readFile2 <- function(x){
    immData <- read.xlsx2(
        file = x[[2]]
        ,sheetName = x[[3]]
        ,startRow = as.numeric(x[4])
        ,endRow = as.numeric(x[5])
        ,colClasses = immClasses
    )
    immData <- colClean(immData)

    immData <- mutate(immData, Time_Period = as.Date(as.numeric(x[6])-2, 
                                                     origin="1900-01-01"))
}

```

```{r load,cache=TRUE, echo=TRUE}
allframes <- apply(dataDetails, 1, readFile2)

immDataAll <- do.call(rbind,allframes)

immDataAll$Age_Group <- ageFactors(immDataAll$Age_Group)

save(immDataAll, file = ".\\data\\processed\\immDataAll.Rda")

head(immDataAll)


```

## Slide with Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## Slide with R Output

```{r cars, echo = TRUE}
summary(cars)
```

## Slide with Plot

```{r pressure}
plot(pressure)
```

